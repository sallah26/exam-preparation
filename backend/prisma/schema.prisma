generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id           String         @id @default(cuid())
  name         String
  email        String         @unique
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  isActive     Boolean        @default(true)
  password     String
  role         UserRole       @default(USER)
  userProgress UserProgress[]

  @@map("users")
}

model Admin {
  id            String         @id @default(cuid())
  fullName      String
  email         String         @unique
  password      String
  isActive      Boolean        @default(true)
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  createdBy     String?
  isSuperAdmin  Boolean        @default(false)
  creator       Admin?         @relation("AdminCreator", fields: [createdBy], references: [id])
  createdAdmins Admin[]        @relation("AdminCreator")
  refreshTokens RefreshToken[]

  @@index([createdBy], map: "admins_createdBy_fkey")
  @@map("admins")
}

model RefreshToken {
  id        String   @id @default(cuid())
  token     String   @unique @db.VarChar(1000)
  adminId   String
  expiresAt DateTime
  isRevoked Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  admin     Admin    @relation(fields: [adminId], references: [id], onDelete: Cascade)

  @@index([adminId], map: "refresh_tokens_adminId_fkey")
  @@map("refresh_tokens")
}

model UserProgress {
  id           String   @id @default(cuid())
  userId       String
  materialId   String
  completed    Boolean  @default(false)
  timeSpent    Int      @default(0)
  lastAccessed DateTime @default(now())
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  material     Material @relation(fields: [materialId], references: [id], onDelete: Cascade)
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, materialId])
  @@index([userId])
  @@index([materialId], map: "user_progress_materialId_fkey")
  @@map("user_progress")
}

model ExamType {
  id          String       @id @default(cuid())
  name        String       @unique
  description String?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  departments Department[]

  @@map("exam_types")
}

model Department {
  id              String           @id @default(cuid())
  name            String
  examTypeId      String
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  academicPeriods AcademicPeriod[]
  examType        ExamType         @relation(fields: [examTypeId], references: [id], onDelete: Cascade)

  @@index([examTypeId])
  @@map("departments")
}

model AcademicPeriod {
  id           String     @id @default(cuid())
  name         String
  departmentId String
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  department   Department @relation(fields: [departmentId], references: [id], onDelete: Cascade)
  materials    Material[]

  @@index([departmentId])
  @@map("academic_periods")
}

model Material {
  id               String         @id @default(cuid())
  title            String
  type             MaterialType
  academicPeriodId String
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  documents        Document[]
  academicPeriod   AcademicPeriod @relation(fields: [academicPeriodId], references: [id], onDelete: Cascade)
  questions        Question[]
  userProgress     UserProgress[]

  @@index([academicPeriodId])
  @@map("materials")
}

model Document {
  id           String   @id @default(cuid())
  materialId   String
  filePath     String
  fileType     String
  originalName String
  createdAt    DateTime @default(now())
  material     Material @relation(fields: [materialId], references: [id], onDelete: Cascade)

  @@index([materialId])
  @@map("documents")
}

model Question {
  id           String           @id @default(cuid())
  materialId   String
  questionText String           @db.Text
  explanation  String?          @db.Text
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt
  options      QuestionOption[]
  material     Material         @relation(fields: [materialId], references: [id], onDelete: Cascade)

  @@index([materialId])
  @@map("questions")
}

model QuestionOption {
  id         String   @id @default(cuid())
  questionId String
  optionText String   @db.Text
  isCorrect  Boolean  @default(false)
  createdAt  DateTime @default(now())
  question   Question @relation(fields: [questionId], references: [id], onDelete: Cascade)

  @@index([questionId])
  @@map("question_options")
}

enum UserRole {
  SUPER_ADMIN
  ADMIN
  USER
}

enum MaterialType {
  DOCUMENT
  QUESTION
}
